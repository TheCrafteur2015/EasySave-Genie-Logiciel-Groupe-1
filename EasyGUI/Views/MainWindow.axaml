<Window xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:vm="using:EasyGUI.ViewModels"
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
		x:Class="EasyGUI.Views.MainWindow"
		x:Name="MainWindowRoot"
		x:DataType="vm:MainWindowViewModel"
		Icon="/Assets/avalonia-logo.ico"
		Title="ProSoft EasySave 3.0"
		Width="1200"
		Height="750"
		MinWidth="900"
		MinHeight="600"
		WindowState="Maximized"
		WindowStartupLocation="CenterScreen">

	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<Grid ColumnDefinitions="260, *">

		<Border Grid.Column="0" Classes="Sidebar">
			<Grid RowDefinitions="Auto, *, Auto">

				<StackPanel Grid.Row="0" Margin="0,30,0,40">
					<TextBlock Text="EasySave" HorizontalAlignment="Center" FontSize="28" FontWeight="Bold" Foreground="#F6E05E"/>
					<TextBlock Text="{Binding L[app_title]}" HorizontalAlignment="Center" FontSize="12" Opacity="0.6"/>
				</StackPanel>

				<StackPanel Grid.Row="1" Spacing="5">

					<Button Classes="NavButton" Command="{Binding BackToMenuCommand}">
						<TextBlock Text="{Binding L[menu_dashboard]}"/>
					</Button>

					<Separator Height="1" Margin="20,10"/>
					<TextBlock Text="{Binding L[menu_actions_title]}" FontSize="10" FontWeight="Bold" Opacity="0.5" Margin="25,0,0,5"/>

					<Button Classes="NavButton" Command="{Binding CreateBackupJobCommand}">
						<TextBlock Text="{Binding L[menu_create]}"/>
					</Button>

					<Button Classes="NavButton" Command="{Binding ExecuteBackupJobCommand}">
						<TextBlock Text="{Binding L[menu_execute]}"/>
					</Button>

					<Button Classes="NavButton" Command="{Binding ExecuteAllBackupJobsCommand}">
						<TextBlock Text="{Binding L[menu_execute_all]}"/>
					</Button>

					<Button Classes="NavButton" Command="{Binding ListAllBackupJobsCommand}">
						<TextBlock Text="{Binding L[menu_list]}"/>
					</Button>

					<Button Classes="NavButton" Command="{Binding DeleteBackupJobCommand}">
						<TextBlock Text="{Binding L[menu_delete]}"/>
					</Button>
				</StackPanel>

				<StackPanel Grid.Row="2" Margin="0,0,0,20">
					<Button Classes="NavButton" Command="{Binding OpenSettingsCommand}">
						<TextBlock Text="{Binding L[menu_settings]}"/>
					</Button>
					<Button Classes="NavButton" Command="{Binding ExitCommand}" Foreground="#FC8181">
						<TextBlock Text="{Binding L[menu_exit]}"/>
					</Button>
				</StackPanel>
			</Grid>
		</Border>

		<Grid Grid.Column="1" RowDefinitions="Auto, *" Name="MainContentArea" Background="{DynamicResource AppBackgroundBrush}">

			<Border Grid.Row="0" Height="60" BoxShadow="0 2 5 0 #05000000">
				<Grid ColumnDefinitions="*, Auto" Margin="30,0">
					<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
						<Button Content="{Binding L[theme_dark]}" 
								Command="{Binding SwitchThemeCommand}" 
								CommandParameter="Dark" 
								Background="Transparent" 
								BorderThickness="0"
								IsVisible="{Binding $parent[Window].ActualThemeVariant, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static ThemeVariant.Light}}"/>
						<Button Content="{Binding L[theme_light]}" 
								Command="{Binding SwitchThemeCommand}" 
								CommandParameter="Light" 
								Background="Transparent" 
								BorderThickness="0"
								IsVisible="{Binding $parent[Window].ActualThemeVariant, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static ThemeVariant.Dark}}"/>
					</StackPanel>
				</Grid>
			</Border>

			<Panel Grid.Row="1" Margin="10">

				<Border Classes="Card" IsVisible="{Binding CurrentView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Menu}">
					<StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20">
						<TextBlock Text="{Binding L[dashboard_welcome]}" FontSize="32" FontWeight="Bold" HorizontalAlignment="Center"/>
						<TextBlock Text="{Binding L[dashboard_subtitle]}" FontSize="18" HorizontalAlignment="Center" Opacity="0.7"/>
					</StackPanel>
				</Border>

				<Border Classes="Card" IsVisible="{Binding CurrentView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=CreateJob}">
					<StackPanel Spacing="20" MaxWidth="500">
						<TextBlock Text="{Binding L[create_title]}" FontSize="24" FontWeight="Bold"/>
						<Separator/>

						<StackPanel Spacing="5">
							<TextBlock Text="{Binding L[create_name]}" FontWeight="Medium"/>
							<TextBox Text="{Binding NewJobName}"/>
						</StackPanel>

						<StackPanel Spacing="5">
							<TextBlock Text="{Binding L[create_source]}" FontWeight="Medium"/>
							<TextBox Text="{Binding NewJobSource}"/>
						</StackPanel>

						<StackPanel Spacing="5">
							<TextBlock Text="{Binding L[create_target]}" FontWeight="Medium"/>
							<TextBox Text="{Binding NewJobTarget}"/>
						</StackPanel>

						<StackPanel Spacing="5">
							<TextBlock Text="{Binding L[create_type]}" FontWeight="Medium"/>
							<ComboBox SelectedIndex="{Binding SelectedBackupType}" 
									  ItemsSource="{Binding BackupTypes}"
									  HorizontalAlignment="Stretch"/>
						</StackPanel>

						<TextBlock Text="{Binding StatusMessage}" Foreground="Red" TextWrapping="Wrap"/>

						<StackPanel Orientation="Horizontal" Spacing="15" Margin="0,20,0,0">
							<Button Classes="Primary" Content="{Binding L[btn_save]}" Command="{Binding SaveNewJobCommand}"/>
							<Button Content="{Binding L[btn_cancel]}" Command="{Binding BackToMenuCommand}" Background="Transparent"/>
						</StackPanel>
					</StackPanel>
				</Border>

				<Border Classes="Card" IsVisible="{Binding CurrentView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=ExecuteJob}">
						<StackPanel Spacing="20" MaxWidth="600">
							<StackPanel>
								<TextBlock Text="{Binding L[execute_title]}" FontSize="24" FontWeight="Bold"/>
								<TextBlock Text="{Binding L[execute_subtitle]}" Opacity="0.7" Margin="0,5,0,0"/>
							</StackPanel>

							<Separator/>

							<ComboBox ItemsSource="{Binding BackupJobs}"
									  SelectedItem="{Binding SelectedJob}"
									  HorizontalAlignment="Stretch"
									  PlaceholderText="{Binding L[execute_placeholder]}">
								<ComboBox.ItemTemplate>
									<DataTemplate>
										<TextBlock Text="{Binding Name}" FontWeight="Bold"/>
									</DataTemplate>
								</ComboBox.ItemTemplate>
							</ComboBox>

							<!-- Carte de progression (visible pendant l'exécution) -->
							<Border CornerRadius="8" 
									Padding="15" 
									BorderThickness="1" 
									BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
									IsVisible="{Binding IsExecuting}">
								<StackPanel Spacing="10">
									<!-- Nom du job en cours -->
									<Grid ColumnDefinitions="*, Auto">
										<TextBlock Grid.Column="0" 
												   Text="{Binding SelectedJob.Name}" 
												   FontWeight="SemiBold" 
												   FontSize="16"/>
										<TextBlock Grid.Column="1" 
												   Text="{Binding CurrentFileInfo}" 
												   FontSize="12" 
												   Opacity="0.7" 
												   VerticalAlignment="Center"/>
									</Grid>

									<!-- Barre de progression -->
									<ProgressBar Value="{Binding CurrentProgress}" 
												 Minimum="0"
												 Maximum="100"
												 Height="8" 
												 Foreground="#F6E05E"/>

									<!-- Status détaillé -->
									<TextBlock Text="{Binding StatusMessage}" 
											   FontSize="12" 
											   Opacity="0.8"
											   TextWrapping="Wrap"/>
								</StackPanel>
							</Border>

							<!-- Message de succès (visible après l'exécution) -->
							<TextBlock Text="{Binding StatusMessage}" 
									   Foreground="#48BB78"
									   FontWeight="SemiBold"
									   TextWrapping="Wrap"
									   IsVisible="{Binding !IsExecuting}"/>

							<!-- Bouton Start -->
							<Button Classes="Primary"
									Content="{Binding L[btn_start]}"
									Command="{Binding ExecuteSelectedJobCommand}"
									IsEnabled="{Binding !IsExecuting}"
									HorizontalAlignment="Stretch"
									HorizontalContentAlignment="Center"/>
						</StackPanel>
					</Border>

				<!-- Vue Execute All avec progression de chaque job -->
					<Border Classes="Card" IsVisible="{Binding CurrentView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=ExecuteAll}">
						<StackPanel Spacing="20" MaxWidth="800">
							<StackPanel>
								<TextBlock Text="{Binding L[execute_all_title]}" FontSize="24" FontWeight="Bold"/>
								<TextBlock Text="{Binding L[execute_all_subtitle]}" Opacity="0.7" Margin="0,5,0,0"/>
							</StackPanel>

							<Separator/>

							<!-- Liste des jobs avec leur progression -->
							<ScrollViewer MaxHeight="500">
								<ItemsControl ItemsSource="{Binding JobsProgress}">
									<ItemsControl.ItemTemplate>
										<DataTemplate>
											<Border CornerRadius="8" Padding="15" Margin="0,0,0,10" BorderThickness="1" BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}">
												<StackPanel Spacing="8">
													<!-- Nom du job et status -->
													<Grid ColumnDefinitions="*, Auto">
														<TextBlock Grid.Column="0" Text="{Binding JobName}" FontWeight="SemiBold" FontSize="16"/>
														<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="5">
															<!-- Icône succès -->
															<TextBlock Text="✓" Foreground="#48BB78" FontWeight="Bold" IsVisible="{Binding IsCompleted}"/>
															<!-- Icône erreur -->
															<TextBlock Text="✗" Foreground="#FC8181" FontWeight="Bold" IsVisible="{Binding HasError}"/>
															<!-- Texte status -->
															<TextBlock Text="{Binding Status}" FontSize="12" Opacity="0.7" VerticalAlignment="Center"/>
														</StackPanel>
													</Grid>

													<!-- Barre de progression -->
													<ProgressBar Value="{Binding ProgressPercentage}" 
																 Minimum="0" 
																 Maximum="100"
																 Height="8"
																 Foreground="#F6E05E"/>
												</StackPanel>
											</Border>
										</DataTemplate>
									</ItemsControl.ItemTemplate>
								</ItemsControl>
							</ScrollViewer>

							<!-- Message global -->
							<TextBlock Text="{Binding StatusMessage}" 
									   Foreground="#48BB78"
									   FontWeight="SemiBold"
									   TextWrapping="Wrap"
									   IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

							<!-- Bouton Start All -->
							<Button Classes="Primary"
									Content="{Binding L[btn_start_all]}"
									Command="{Binding StartAllBackupJobsCommand}"
									IsEnabled="{Binding !IsExecuting}"
									HorizontalAlignment="Stretch"
									HorizontalContentAlignment="Center"/>
						</StackPanel>
					</Border>

				<Border Classes="Card" IsVisible="{Binding CurrentView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=ListJobs}">
					<Grid RowDefinitions="Auto, *">
						<TextBlock Grid.Row="0" Text="{Binding L[list_title]}" FontSize="24" FontWeight="Bold" Margin="0,0,0,20"/>
						<ListBox Grid.Row="1" ItemsSource="{Binding BackupJobs}" Background="Transparent" BorderThickness="0">
							<ListBox.Styles>
								<Style Selector="ListBoxItem">
									<Setter Property="Padding" Value="0"/>
									<Setter Property="Margin" Value="0,0,0,10"/>
									<Setter Property="Background" Value="Transparent"/>
									<Setter Property="BorderThickness" Value="0"/>
								</Style>
								<Style Selector="ListBoxItem:selected /template/ ContentPresenter">
									<Setter Property="Background" Value="Transparent"/>
								</Style>
							</ListBox.Styles>
							<ListBox.ItemTemplate>
								<DataTemplate>
									<Border BorderThickness="0" CornerRadius="8" Padding="15" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}">
										<Grid ColumnDefinitions="50, *, Auto">
											<Border Grid.Column="0" Background="#F6E05E" Width="40" Height="40" CornerRadius="20">
												<TextBlock Text="{Binding Id}" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" Foreground="#2D3748"/>
											</Border>
											<StackPanel Grid.Column="1" Margin="15,0">
												<TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="16"/>
												<TextBlock Text="{Binding SourceDirectory}" FontSize="12" Opacity="0.7"/>
												<TextBlock Text="{Binding TargetDirectory}" FontSize="12" Opacity="0.7"/>
											</StackPanel>
											<Border Grid.Column="2" CornerRadius="4" Padding="10,5" VerticalAlignment="Center" Opacity="0.8">
												<TextBlock Text="{Binding Type}" FontSize="12" FontWeight="SemiBold"/>
											</Border>
										</Grid>
									</Border>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</Grid>
				</Border>

				<Border Classes="Card" IsVisible="{Binding CurrentView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=DeleteJob}">
					<StackPanel Spacing="20" MaxWidth="500">
						<TextBlock Text="{Binding L[delete_title]}" FontSize="24" FontWeight="Bold" Foreground="#E53E3E"/>
						<TextBlock Text="{Binding L[delete_warning]}" Opacity="0.8"/>

						<ComboBox ItemsSource="{Binding BackupJobs}"
								 SelectedItem="{Binding SelectedJob}"
								 HorizontalAlignment="Stretch"
								 PlaceholderText="{Binding L[execute_placeholder]}">
							<ComboBox.ItemTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding Name}"/>
								</DataTemplate>
							</ComboBox.ItemTemplate>
						</ComboBox>

						<!-- Message de statut -->
						<TextBlock Text="{Binding StatusMessage}" 
								   Foreground="#48BB78"
								   FontWeight="SemiBold"
								   TextWrapping="Wrap"
								   IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

						<Button Content="{Binding L[btn_delete]}"
								Background="#E53E3E"
								Foreground="White"
								Padding="20,10"
								CornerRadius="6"
								HorizontalAlignment="Stretch"
								HorizontalContentAlignment="Center"
								Command="{Binding DeleteSelectedJobCommand}"/>
					</StackPanel>
				</Border>

				<Border Classes="Card" IsVisible="{Binding CurrentView, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Settings}">
					<StackPanel Spacing="25" MaxWidth="500">
						<TextBlock Text="{Binding L[settings_title]}" FontSize="24" FontWeight="Bold"/>

						<Separator/>

						<!-- Section Langue -->
						<StackPanel Spacing="10">
							<TextBlock Text="{Binding L[settings_lang]}" FontWeight="SemiBold" FontSize="16"/>
							<ComboBox SelectedIndex="{Binding SelectedLanguage}" HorizontalAlignment="Stretch">
								<ComboBoxItem>English</ComboBoxItem>
								<ComboBoxItem>Français</ComboBoxItem>
							</ComboBox>
						</StackPanel>

						<Separator/>

						<!-- Section Mode Fenêtre -->
						<StackPanel Spacing="10">
							<TextBlock Text="{Binding L[settings_window_mode]}" FontWeight="SemiBold" FontSize="16"/>
							<ComboBox SelectedIndex="{Binding SelectedWindowMode}" 
									  ItemsSource="{Binding WindowModes}"
									  HorizontalAlignment="Stretch"/>
						</StackPanel>

						<!-- Message de confirmation -->
						<TextBlock Text="{Binding StatusMessage}" 
								   Foreground="#48BB78" 
								   FontWeight="SemiBold"
								   TextWrapping="Wrap"
								   IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

						<Button Classes="Primary" Content="{Binding L[btn_apply]}" Command="{Binding ApplySettingsCommand}" Margin="0,10,0,0"/>
					</StackPanel>
				</Border>

			</Panel>
		</Grid>
	</Grid>
</Window>
